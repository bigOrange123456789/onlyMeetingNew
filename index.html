<!DOCTYPE html>
<html lang="en">
	<head>
		<title>MEETING</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {overflow:hidden;}
		</style>
	</head>

	<body style="margin: 0">
	<script src="js/lib/threeJS/three.js"></script>
	<script src="js/lib/threeJS/OrbitControls.js"></script>
	<script src="js/lib/threeJS/GLTFLoader.js"></script>

	<script src="js/lib/pmLib/MyPMLoader.js"></script>

	<script src="js/lib/instancedLib/InstancedGroup.js"></script>
	<script src="js/lib/instancedLib/SkinnedMeshController.js"></script>

	<script src="js/VideoManager.js"></script>

	<script src="js/sceneSet/SeatManager.js"></script>
	<script src="js/sceneSet/AvatarManager.js"></script>

	<script src="js/playerControl/PlayerControl.js"></script>


	<script src="js/ParamMeasure.js"></script>
	<script src="js/Main.js"></script>

	<script src="StereoEffect.js"></script>

	<div id="cheat" style="position:absolute;left:0;right:0;background-size:100%;background:#01f;">
		<img id="bg" src="bg.png" style="background-size:100%;position:absolute;left:0;right:0;" />
	</div>
	<script>
		document.getElementById("cheat").width=window.innerWidth;
		document.getElementById("cheat").height=window.innerHeight;
		document.getElementById("bg").width=window.innerWidth;
		document.getElementById("bg").height=window.innerHeight;
		var width=120, height=50;
		var oButton=document.createElement('p');//按钮
		oButton.innerHTML="进入会议";
		oButton.style.cssText='font-size:20px;'//字体大小
				+'width:120px;height:50px;'//按钮大小
				+'color:white;'//字体颜色
				+'background:#2ECC71;'//按钮颜色
				+'vertical-align:middle;'
				+'text-align:center;'
				+'line-height:50px;'
				+'border-radius: 6px;'
				+'position:fixed;'//到窗体的位置
				+'left:'+(window.innerWidth/2-width/2)+'px;'//到部件左边距离
				+'top:'+(window.innerHeight/2-height/2)+'px;'; //到部件右边 距离
		oButton.style.cursor='hand';
		oButton.onmouseover=function(){
			oButton.style.cursor='hand';
			oButton.style.borderRadius='70px';
			oButton.style.backgroundColor = '#81F79F';
		}
		oButton.onmouseout=function(){
			oButton.style.cursor='normal';
			oButton.style.borderRadius='6px';
			oButton.style.backgroundColor = '#2ECC71';
		}
		oButton.onmousedown = function() {
			document.getElementById("cheat").style.visibility='hidden';
		}
		oButton.onmouseup = function() {
			oButton.style.backgroundColor = '#81F79F';
			oButton.style.color = 'white';
		}
		document.getElementById("cheat").appendChild(oButton);
	</script>

	<script  type="module">
		//import { VRButton } from './js//lib/VRButton.js';//负责VR视觉
		import {RoomManager} from './js/sceneSet/RoomManager.js';
		import {PreviewManager} from './js/playerControl/PreviewManager.js';
		import {Net} from './js/simulate/Net.js';
		//import {MoveManager} from './js/playerControl/MoveManager.js';

		var myMain = new Main();
		myMain.start();
		window.camera=myMain.camera;
		//document.body.appendChild( VRButton.createButton( myMain.renderer ) );
		//myMain.renderer.xr.enabled = true;

		var myVideoManager = new VideoManager();

		var myRoomManager = new RoomManager(myVideoManager,myMain.camera);
		myMain.scene.add(myRoomManager.room);

		new PlayerControl(myMain.camera);//.cullingTest(myMain.scene)

		var mySeatManager = new SeatManager();
		mySeatManager.init();
		myMain.scene.add(mySeatManager.chairs);

		var myAvatarManager = new AvatarManager(mySeatManager, myMain.camera);
		myMain.scene.add(myAvatarManager.obj);

		//myRoomManager.create1();//网格
		myAvatarManager.create1(function () {
			//myRoomManager.create2();//贴图
			myAvatarManager.create2();//嘉宾
			mySeatManager.create();//椅子
		});//听众

		var net=new Net().object;
		net.position.set(170,17,-59)
		net.scale.set(-0.03,0.03,0.04)
		net.rotation.set(0,Math.PI/2,0)
		myMain.scene.add(net);


		net=new Net().object;
		net.position.set(170,17,29)
		net.scale.set(0.03,0.03,0.04)
		net.rotation.set(0,Math.PI/2,0)
		myMain.scene.add(net);
		/**/
		//new ParamMeasure(net,0)

		const light = new THREE.PointLight( 0xffffff, 1 );
		light.position.set(0,40.97,0)
		light.rotation.set(0,Math.PI/2,0)
		//light.rotation.set(Math.PI/2,0,0);
		myMain.scene.add(light)

		/*
		const geometry = new THREE.BoxGeometry( 5, 40, 5 );
		const material = new THREE.MeshBasicMaterial( {color: 0x00ff00} );
		const cube = new THREE.Mesh( geometry, material );
		light.add( cube );
		*/

		//开始自动漫游路径
		var mydata = [//自动漫游路径
			//x         y      z      angel       time  展板编号  展板初始旋转(单位是90度)
			[-155, 41, 22, -1.5572, -1.47875, -1.55714, 80]
			, [-119, 39, 24, -0.91, -1.48, -0.91, 80]
			, [-59, 48, -14, -1.25, -1.52, -1.24, 80]
				,[-122,39,-116,-2.863791,-1.04, -2.8,80]
			, [129, 37, -66, -1.25, -1.52, -1.24, 200]


			, [186.629944, 26.749136,-64.9026,-1.678751829760329,-1.183107113654890, -1.68733072496894, 50]
			, [186.629944, 26.749137,-64.9027,-1.678751829760328,-1.183107113654891, -1.68733072496893, 200]
				//184.61, 26.1, -64.97
			, [130, 37, -12, -1.25, -1.52, -1.24, 50]
			, [129, 37, -27, -1.25, -1.52, -1.24, 50]
			, [229, 29, -19, -1.21, 1.46, 1.19, 80]
			, [183, 63, -19, -1.67, 1.35, 1.66, 80]
				/**/
		];
		var myPreviewManager = new PreviewManager(myMain.camera, mydata, myVideoManager);
		//myPreviewManager.createCameraButton('./img/1.png', './img/2.png');
		//结束自动漫游路径
		function f00() {
			requestAnimationFrame(f00);
			if(!myVideoManager.finish&&document.getElementById("cheat").style.visibility==='hidden'){
				myVideoManager.setPlay()
				myPreviewManager.myMoveManager.stopFlag = false;
			}
		}f00()

		//开始帧数统计
		var tag = document.createElement('h1');
		window.tag=tag;
		tag.style.cssText =
				'color:green;' +//文字颜色
				'font-size:' + 20 + 'px;' +//文字大小
				'font-weight:normal;' +
				'position:fixed;' +//到窗体的位置
				'left:' + 0 + 'px;' +//到部件左边距离
				'top:' + 0 + 'px;'; //到部件右边 距离
		document.body.appendChild(tag);
		var frameIndex = 0, frameIndexPre = 0;
		frameIndexUpdate();
		setInterval(computeFPS, 1000);
		function frameIndexUpdate() {
			frameIndex++;
			requestAnimationFrame(frameIndexUpdate);
		}
		function computeFPS() {
			tag.innerHTML =(frameIndex - frameIndexPre);
			//tag.innerHTML = "FPS:" + (frameIndex - frameIndexPre);
			frameIndexPre = frameIndex;
		}
		//完成帧数统计

		//开始添加时钟
		window.myClock=0;
		setInterval(function () {
			window.myClock++;
		},1)
		//完成添加时钟
	</script>
	</body>
</html>
